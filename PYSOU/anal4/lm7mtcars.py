"""
선형회귀분석 - OLS() 사용
사용 데이터 : mtcars 데이터 셋을 사용 - 독립변수가 종속변수(mpg, 연비)에 영향을 미치는가?
"""
import pandas as pd
import numpy as np
import statsmodels.formula.api as smf
import matplotlib.pyplot as plt
import seaborn as sns
import statsmodels.api


mtcars = statsmodels.api.datasets.get_rdataset('mtcars').data
print(mtcars)
"""
                      mpg  cyl   disp   hp  drat     wt   qsec  vs  am  gear  carb
rownames
Mazda RX4            21.0    6  160.0  110  3.90  2.620  16.46   0   1     4     4
Mazda RX4 Wag        21.0    6  160.0  110  3.90  2.875  17.02   0   1     4     4
Datsun 710           22.8    4  108.0   93  3.85  2.320  18.61   1   1     4     1
Hornet 4 Drive       21.4    6  258.0  110  3.08  3.215  19.44   1   0     3     1
Hornet Sportabout    18.7    8  360.0  175  3.15  3.440  17.02   0   0     3     2
Valiant              18.1    6  225.0  105  2.76  3.460  20.22   1   0     3     1
Duster 360           14.3    8  360.0  245  3.21  3.570  15.84   0   0     3     4
Merc 240D            24.4    4  146.7   62  3.69  3.190  20.00   1   0     4     2
Merc 230             22.8    4  140.8   95  3.92  3.150  22.90   1   0     4     2
Merc 280             19.2    6  167.6  123  3.92  3.440  18.30   1   0     4     4
Merc 280C            17.8    6  167.6  123  3.92  3.440  18.90   1   0     4     4
Merc 450SE           16.4    8  275.8  180  3.07  4.070  17.40   0   0     3     3
Merc 450SL           17.3    8  275.8  180  3.07  3.730  17.60   0   0     3     3
Merc 450SLC          15.2    8  275.8  180  3.07  3.780  18.00   0   0     3     3
Cadillac Fleetwood   10.4    8  472.0  205  2.93  5.250  17.98   0   0     3     4
Lincoln Continental  10.4    8  460.0  215  3.00  5.424  17.82   0   0     3     4
Chrysler Imperial    14.7    8  440.0  230  3.23  5.345  17.42   0   0     3     4
Fiat 128             32.4    4   78.7   66  4.08  2.200  19.47   1   1     4     1
Honda Civic          30.4    4   75.7   52  4.93  1.615  18.52   1   1     4     2
Toyota Corolla       33.9    4   71.1   65  4.22  1.835  19.90   1   1     4     1
Toyota Corona        21.5    4  120.1   97  3.70  2.465  20.01   1   0     3     1
Dodge Challenger     15.5    8  318.0  150  2.76  3.520  16.87   0   0     3     2
AMC Javelin          15.2    8  304.0  150  3.15  3.435  17.30   0   0     3     2
Camaro Z28           13.3    8  350.0  245  3.73  3.840  15.41   0   0     3     4
Pontiac Firebird     19.2    8  400.0  175  3.08  3.845  17.05   0   0     3     2
Fiat X1-9            27.3    4   79.0   66  4.08  1.935  18.90   1   1     4     1
Porsche 914-2        26.0    4  120.3   91  4.43  2.140  16.70   0   1     5     2
Lotus Europa         30.4    4   95.1  113  3.77  1.513  16.90   1   1     5     2
Ford Pantera L       15.8    8  351.0  264  4.22  3.170  14.50   0   1     5     4
Ferrari Dino         19.7    6  145.0  175  3.62  2.770  15.50   0   1     5     6
Maserati Bora        15.0    8  301.0  335  3.54  3.570  14.60   0   1     5     8
Volvo 142E           21.4    4  121.0  109  4.11  2.780  18.60   1   1     4     2
"""
print(mtcars.columns)   #['mpg', 'cyl', 'disp', 'hp', 'drat', 'wt', 'qsec', 'vs', 'am', 'gear', 'carb']
print(mtcars.info())
print(mtcars.corr())    # 상관계수 확인
"""
           mpg       cyl      disp        hp      drat        wt      qsec        vs        am      gear      carb
mpg   1.000000 -0.852162 -0.847551 -0.776168  0.681172 -0.867659  0.418684  0.664039  0.599832  0.480285 -0.550925
cyl  -0.852162  1.000000  0.902033  0.832447 -0.699938  0.782496 -0.591242 -0.810812 -0.522607 -0.492687  0.526988
disp -0.847551  0.902033  1.000000  0.790949 -0.710214  0.887980 -0.433698 -0.710416 -0.591227 -0.555569  0.394977
hp   -0.776168  0.832447  0.790949  1.000000 -0.448759  0.658748 -0.708223 -0.723097 -0.243204 -0.125704  0.749812
drat  0.681172 -0.699938 -0.710214 -0.448759  1.000000 -0.712441  0.091205  0.440278  0.712711  0.699610 -0.090790
wt   -0.867659  0.782496  0.887980  0.658748 -0.712441  1.000000 -0.174716 -0.554916 -0.692495 -0.583287  0.427606
qsec  0.418684 -0.591242 -0.433698 -0.708223  0.091205 -0.174716  1.000000  0.744535 -0.229861 -0.212682 -0.656249
vs    0.664039 -0.810812 -0.710416 -0.723097  0.440278 -0.554916  0.744535  1.000000  0.168345  0.206023 -0.569607
am    0.599832 -0.522607 -0.591227 -0.243204  0.712711 -0.692495 -0.229861  0.168345  1.000000  0.794059  0.057534
gear  0.480285 -0.492687 -0.555569 -0.125704  0.699610 -0.583287 -0.212682  0.206023  0.794059  1.000000  0.274073
carb -0.550925  0.526988  0.394977  0.749812 -0.090790  0.427606 -0.656249 -0.569607  0.057534  0.274073  1.000000
"""
print(np.corrcoef(mtcars.hp, mtcars.mpg)[0,1])  #상관계수 확인, -0.7761683718265864
print(np.corrcoef(mtcars.wt, mtcars.mpg)[0,1])  #상관계수 확인, -0.8676593765172281

#시각화 확인 : mtcars.hp, mtcars.mpg
#plt.scatter(mtcars.hp, mtcars.mpg)
#plt.xlabel('hp')
#plt.ylabel('mpg')
#plt.show()
#plt.close()

#단순 선형회귀 실시
result = smf.ols(formula="mpg ~ hp", data=mtcars).fit()
print(result.summary())
"""
                            OLS Regression Results
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.602
Model:                            OLS   Adj. R-squared:                  0.589
Method:                 Least Squares   F-statistic:                     45.46
Date:                Mon, 25 Aug 2025   Prob (F-statistic):           1.79e-07
Time:                        12:14:10   Log-Likelihood:                -87.619
No. Observations:                  32   AIC:                             179.2
Df Residuals:                      30   BIC:                             182.2
Df Model:                           1
Covariance Type:            nonrobust
==============================================================================
                 coef    std err          t      P>|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     30.0989      1.634     18.421      0.000      26.762      33.436
hp            -0.0682      0.010     -6.742      0.000      -0.089      -0.048
==============================================================================
Omnibus:                        3.692   Durbin-Watson:                   1.134
Prob(Omnibus):                  0.158   Jarque-Bera (JB):                2.984
Skew:                           0.747   Prob(JB):                        0.225
Kurtosis:                       2.935   Cond. No.                         386.
==============================================================================
"""

#마력수 110에 대한 연비 예측
print(-0.0682 * 110 + 30.0989)  #22.5969
print(result.predict(pd.DataFrame({'hp' : [110]}))) #22.59375
#마력수 50에 대한 연비 예측
print(-0.0682 * 50 + 30.0989)   #26.6889
print(result.predict(pd.DataFrame({'hp' : [50]})))  #26.687447




#다중 선형회귀 실시
result2 = smf.ols(formula="mpg ~ hp + wt", data=mtcars).fit()
print(result2.summary())
"""
                            OLS Regression Results
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.827
Model:                            OLS   Adj. R-squared:                  0.815
Method:                 Least Squares   F-statistic:                     69.21
Date:                Mon, 25 Aug 2025   Prob (F-statistic):           9.11e-12
Time:                        12:20:56   Log-Likelihood:                -74.326
No. Observations:                  32   AIC:                             154.7
Df Residuals:                      29   BIC:                             159.0
Df Model:                           2
Covariance Type:            nonrobust
==============================================================================
                 coef    std err          t      P>|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     37.2273      1.599     23.285      0.000      33.957      40.497
hp            -0.0318      0.009     -3.519      0.001      -0.050      -0.013
wt            -3.8778      0.633     -6.129      0.000      -5.172      -2.584
==============================================================================
Omnibus:                        5.303   Durbin-Watson:                   1.362
Prob(Omnibus):                  0.071   Jarque-Bera (JB):                4.046
Skew:                           0.855   Prob(JB):                        0.132
Kurtosis:                       3.332   Cond. No.                         588.
==============================================================================
Adj. R-squared, Prob (F-statistic), t값 모두 유이한 모델임.
"""

